<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart OCR Pro - Data Extractor</title>
  <script src="https://unpkg.com/tesseract.js@5/dist/tesseract.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500&display=swap" rel="stylesheet">
  
  <style>
    :root {
      --primary: #4f46e5;
      --primary-hover: #4338ca;
      --bg: #f1f5f9;
      --card: #ffffff;
      --text: #1e293b;
    }

    body {
      font-family: 'Kanit', sans-serif;
      background-color: var(--bg);
      color: var(--text);
      margin: 0;
      display: flex;
      justify-content: center;
      padding: 20px;
    }

    .container { width: 100%; max-width: 800px; }

    .card {
      background: var(--card);
      border-radius: 20px;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
      padding: 30px;
    }

    header { text-align: center; margin-bottom: 25px; }
    h1 { color: var(--primary); margin: 0; font-size: 1.8rem; }
    p.desc { color: #64748b; font-size: 0.9rem; margin-top: 5px; }

    #dropzone {
      border: 2px dashed #cbd5e1;
      background: #f8fafc;
      border-radius: 15px;
      padding: 50px 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s ease-in-out;
    }

    #dropzone:hover { border-color: var(--primary); background: #f5f7ff; }
    #dropzone.dragover { border-color: var(--primary); background: #e0e7ff; transform: scale(1.01); }

    .status-container {
      margin-top: 20px;
      padding: 15px;
      border-radius: 10px;
      background: #eef2ff;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      color: var(--primary);
      font-weight: 500;
    }

    .loader {
      border: 3px solid #e2e8f0;
      border-top: 3px solid var(--primary);
      border-radius: 50%;
      width: 18px;
      height: 18px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    .result-section { margin-top: 25px; }

    .toolbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    textarea {
      width: 100%;
      height: 350px;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      padding: 15px;
      font-family: 'Courier New', monospace;
      font-size: 16px;
      line-height: 1.6;
      resize: vertical;
      box-sizing: border-box;
      outline: none;
    }

    .btn {
      background: var(--primary);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 500;
    }

    .btn:hover { background: var(--primary-hover); }
    .hidden { display: none !important; }
  </style>
</head>
<body>

<div class="container">
  <div class="card">
    <header>
      <h1>Smart OCR Pro</h1>
      <p class="desc">‡πÄ‡∏ô‡πâ‡∏ô‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• <b>‡∏ä‡∏∑‡πà‡∏≠ + ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç</b> | ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Ctrl+V ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏á‡∏£‡∏π‡∏õ</p>
    </header>

    <div id="dropzone">
      <span style="font-size: 40px;">üì∏</span>
      <p>‡∏•‡∏≤‡∏Å‡∏£‡∏π‡∏õ‡∏°‡∏≤‡∏ß‡∏≤‡∏á, ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‡∏´‡∏£‡∏∑‡∏≠ <strong>‡∏Å‡∏î Ctrl+V ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</strong></p>
      <input type="file" id="fileInput" accept="image/*" hidden />
    </div>

    <div id="statusBox" class="status-container hidden">
      <div class="loader"></div>
      <span id="statusText">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏£‡∏∞‡∏ö‡∏ö...</span>
    </div>

    <div class="result-section">
      <div class="toolbar">
        <strong>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏û‡∏ö:</strong>
        <button class="btn" id="copyBtn">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</button>
      </div>
      <textarea id="result" placeholder="‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏à‡∏∞‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..."></textarea>
    </div>
  </div>
</div>

<script>
  const dropzone = document.getElementById("dropzone");
  const fileInput = document.getElementById("fileInput");
  const resultArea = document.getElementById("result");
  const statusBox = document.getElementById("statusBox");
  const statusText = document.getElementById("statusText");
  const copyBtn = document.getElementById("copyBtn");

  let worker = null;

  // 1. ‡πÇ‡∏´‡∏•‡∏î Worker ‡∏£‡∏≠‡πÑ‡∏ß‡πâ‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤ (Pre-warm)
  async function initWorker() {
    showStatus("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏£‡∏∞‡∏ö‡∏ö OCR (tha+eng)...");
    worker = await Tesseract.createWorker('tha+eng', 1, {
      logger: m => {
        if (m.status === 'recognizing text') {
          showStatus(`‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•: ${(m.progress * 100).toFixed(0)}%`);
        }
      }
    });
    hideStatus();
  }
  initWorker();

  // 2. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
  async function processImage(file) {
    if (!file || !file.type.startsWith('image/')) return;
    if (!worker) {
      alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà ‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î Model...");
      return;
    }

    showStatus("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û...");
    resultArea.value = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå...";
    
    try {
      const { data: { text } } = await worker.recognize(file);
      
      // --- ‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° (Data Cleaning Logic) ---
      const lines = text.split('\n');
      const filteredLines = lines
        .map(line => {
          // ‡∏•‡∏ö‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå‡πÅ‡∏õ‡∏•‡∏Å‡πÜ ‡∏≠‡∏≠‡∏Å‡∏Å‡πà‡∏≠‡∏ô (‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÅ‡∏Ñ‡πà ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£, ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç, ‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á, ‡∏Ñ‡∏≠‡∏°‡∏°‡πà‡∏≤)
          const cleanLine = line.replace(/[^\u0E00-\u0E7Fa-zA-Z0-9\s,]/g, '').trim();
          
          // Regex: ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° (‡∏ä‡∏∑‡πà‡∏≠) ‡∏ï‡∏≤‡∏°‡∏î‡πâ‡∏ß‡∏¢ ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç (‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)
          // ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö: [‡∏ä‡∏∑‡πà‡∏≠] [‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á] [‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏≠‡∏°‡∏°‡πà‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏∏‡∏î‡πÑ‡∏î‡πâ]
          const match = cleanLine.match(/^([a-zA-Z‡∏Å-‡∏Æ0-9_]{2,})\s+([\d,.]+)/);
          
          if (match) {
            return `${match[1]} ${match[2]}`;
          }
          
          // ‡∏Å‡∏£‡∏ì‡∏µ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤ (‡∏ö‡∏≤‡∏á‡∏ó‡∏µ OCR ‡∏≠‡πà‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏°‡∏≤‡∏î‡πâ‡∏ß‡∏¢)
          const matchWithRank = cleanLine.match(/^\d+\s+([a-zA-Z‡∏Å-‡∏Æ0-9_]{2,})\s+([\d,.]+)/);
          if (matchWithRank) {
            return `${matchWithRank[1]} ${matchWithRank[2]}`;
          }

          return null;
        })
        .filter(item => item !== null);

      resultArea.value = filteredLines.join('\n') || "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô";
      
    } catch (err) {
      resultArea.value = "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + err.message;
    }
    hideStatus();
  }

  // 3. Event Listeners
  dropzone.onclick = () => fileInput.click();
  fileInput.onchange = e => processImage(e.target.files[0]);

  dropzone.ondragover = e => { e.preventDefault(); dropzone.classList.add("dragover"); };
  dropzone.ondragleave = () => dropzone.classList.remove("dragover");
  dropzone.ondrop = e => {
    e.preventDefault();
    dropzone.classList.remove("dragover");
    processImage(e.dataTransfer.files[0]);
  };

  // ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Å‡∏î Ctrl + V
  window.addEventListener('paste', e => {
    const items = (e.clipboardData || e.originalEvent.clipboardData).items;
    for (let i = 0; i < items.length; i++) {
      if (items[i].type.indexOf("image") !== -1) {
        processImage(items[i].getAsFile());
      }
    }
  });

  // 4. Helper Functions
  function showStatus(msg) {
    statusBox.classList.remove("hidden");
    statusText.innerText = msg;
  }
  function hideStatus() {
    statusBox.classList.add("hidden");
  }
  copyBtn.onclick = () => {
    resultArea.select();
    document.execCommand("copy");
    const oldText = copyBtn.innerText;
    copyBtn.innerText = "‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!";
    setTimeout(() => copyBtn.innerText = oldText, 2000);
  };
</script>

</body>
</html>
